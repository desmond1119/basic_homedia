# ⚡ 快速清理 GitHub 敏感信息

## 🎯 5 分钟完成清理

---

## ✅ 步骤 1: 轮换 Supabase Key（最重要！）

**必须先做这个，让旧 Key 失效！**

1. 打开 [Supabase Dashboard](https://app.supabase.com/project/jufwllhkgtvovyazgxld/settings/api)
2. 找到 **Project API keys** 部分
3. 点击 **Generate new anon key** 或 **Reset API keys**
4. 复制新的 `anon key`

5. 更新本地 `.env` 文件：
   ```bash
   # 如果没有 .env，先创建
   cp .env.example .env
   
   # 编辑 .env，填入新 key
   VITE_SUPABASE_URL=https://jufwllhkgtvovyazgxld.supabase.co
   VITE_SUPABASE_ANON_KEY=<你的新key>
   ```

6. 测试应用：
   ```bash
   npm run dev
   # 打开浏览器测试登录功能
   ```

✅ **完成！旧 Key 已失效，即使泄露也没用了**

---

## ✅ 步骤 2: 清理 Git 历史

### 方法 A：一键自动清理（推荐）⭐

```bash
# 1. 进入项目目录
cd /Users/gooday/Documents/最好/basie_media

# 2. 给脚本添加执行权限
chmod +x scripts/rebuild-safe-repo.sh

# 3. 运行清理脚本
./scripts/rebuild-safe-repo.sh

# 4. 按提示输入 YES 确认

# 5. 完成后，按提示推送到 GitHub
```

### 方法 B：手动清理

```bash
# 1. 进入项目目录
cd /Users/gooday/Documents/最好/basie_media

# 2. 备份（重要！）
cp -r . ../basie_media_backup

# 3. 删除 Git 历史
rm -rf .git

# 4. 重新初始化
git init

# 5. 添加所有文件
git add .

# 6. 创建初始提交
git commit -m "Initial commit - Security cleanup completed"

# 7. 连接 GitHub（替换成你的仓库地址）
git remote add origin https://github.com/你的用户名/你的仓库名.git

# 8. 推送到 GitHub（强制覆盖）
git push -u origin main --force

# 如果分支是 master，用这个：
# git push -u origin master --force
```

---

## ✅ 步骤 3: 验证清理结果

### 在 GitHub 上检查：

1. 访问你的 GitHub 仓库
2. 点击 **Commits** 查看历史
3. 应该只有 1 个新的提交
4. 点开 `.env.example`，确认只有占位符：
   ```
   VITE_SUPABASE_URL=your-project-url
   VITE_SUPABASE_ANON_KEY=your-anon-key
   ```

### 使用 GitHub 搜索验证：

1. 在仓库页面按 `/` 键打开搜索
2. 搜索部分旧 key 内容（例如 `eyJhbGciOiJIUzI1NiIs`）
3. 应该显示 **No results**

✅ **完成！GitHub 现在是干净的**

---

## ✅ 步骤 4: 配置安全防护（推荐）

### 添加 Pre-commit Hook

```bash
# 1. 安装 husky
npm install -D husky

# 2. 初始化
npx husky install
npm pkg set scripts.prepare="husky install"

# 3. 添加 pre-commit hook
npx husky add .husky/pre-commit "chmod +x scripts/security-check.sh && ./scripts/security-check.sh"

# 4. 测试 hook
git add .
git commit -m "test: Add pre-commit security check"
```

### 启用 GitHub Secret Scanning

1. 访问仓库 **Settings**
2. 进入 **Security & analysis**
3. 启用以下功能：
   - ✅ **Dependency graph**
   - ✅ **Dependabot alerts**
   - ✅ **Secret scanning**
   - ✅ **Push protection**

---

## 📋 完成检查清单

确认以下所有项目：

- [ ] ✅ Supabase Key 已在 Dashboard 轮换
- [ ] ✅ 本地 `.env` 使用新 Key，应用正常运行
- [ ] ✅ `.env.example` 只包含占位符
- [ ] ✅ Git 历史已重建（只有 1 个初始提交）
- [ ] ✅ 已强制推送到 GitHub
- [ ] ✅ GitHub 上搜索不到旧 Key
- [ ] ✅ 备份已保存
- [ ] ✅ Pre-commit hook 已配置（可选）
- [ ] ✅ GitHub Secret Scanning 已启用（可选）

---

## 🎉 完成！

你的项目现在是安全的：

✅ 旧 Key 已失效  
✅ GitHub 历史干净  
✅ 代码正常运行  
✅ 防护措施就位  

---

## 🆘 遇到问题？

### Q: 推送时提示 "rejected"？

```bash
# 使用 --force 强制推送
git push -u origin main --force
```

### Q: 不知道分支名是 main 还是 master？

```bash
# 查看当前分支
git branch

# 如果是 master，推送时用：
git push -u origin master --force
```

### Q: 提示没有权限？

```bash
# 方法 1: 使用 Personal Access Token
# GitHub Settings > Developer settings > Personal access tokens
# 生成新 token，用它作为密码

# 方法 2: 使用 SSH
# 修改远程地址为 SSH 格式
git remote set-url origin git@github.com:你的用户名/你的仓库名.git
```

### Q: 应用无法连接 Supabase？

```bash
# 1. 检查 .env 文件是否存在
cat .env

# 2. 检查 Key 是否正确
# 应该看到以 eyJ 开头的长字符串

# 3. 重启开发服务器
npm run dev
```

---

## 📞 需要帮助？

如果遇到任何问题，告诉我：
1. 你在哪个步骤遇到问题
2. 具体的错误信息是什么
3. 运行了什么命令

我会帮你解决！
